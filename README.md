# Курсовой проект по предмету Информационные системы и базы данных

## Предметная область "Организация оффлайн RPG-турниров"

Предметная область – организация RPG-турниров с приглашенными музыкальными артистами. Всю ответственность за организацию и проведение **турнира** берут на себя **организаторы**. Турниры проводятся в игровых клубах с площадкой для выступления **артистов**. Информация о турнире, порядке его проведения и условиях участия располагается на веб-ресурсе организатора. Организаторы связываются с артистом (или его менеджером), приглашают его принять участие в мероприятии и сообщают всю необходимую информацию.

В рамках одного турнира проводится несколько **игр**. В результате проведенных игр участники зарабатывают очки. Один турнир проводится по одной игре, т. е. по одной **системе правил**. В рамках одной игры один игрок отыгрывает одного **персонажа**. В течение игры происходят **события**, вследствие которых изменяются **характеристики** персонажа. События могут быть инициированы самим персонажем (например, персонаж зашел в болото), одними персонажами по отношению к другим (например, один персонаж атакует другого) или окружением (например, персонаж попал в ловушку). На результаты событий могут влиять характеристики персонажей. От величины той или иной характеристики зависит произойдет событие или нет, и если произойдет, то с какой интенсивностью оно повлияет на персонажа.

На основе результатов всех игр в рамках турнира составляется **таблица результатов**, распределяющая всех игроков по занятым ими местам и определяющая призеров.

Турниры могут быть спонсируемыми третьей стороной, поэтому они могут иметь **спонсора** в лице некой организации.
Организатор и спонсор заключают **контракт**.

#### Некоторые детали о спонсорстве:
Поскольку спонсор предоставляет спонсорский взнос на определенных условиях, принято заключать спонсорский договор. Спонсорский взнос имеет целевой характер, поэтому договор о спонсорстве должен предусматривать встречные обязательства обеих сторон. Так, спонсор обязуется профинансировать запланированное мероприятие путем передачи спонсируемому денежных средств, имущества (товаров, готовой продукции) и т. п. к определенной дате.
Спонсируемый, в свою очередь, обязуется:
*	в ходе проведения запланированного мероприятия в порядке, установленном договором, распространить среди участников информацию о спонсоре, его товарах и/или услугах;
*	провести мероприятие в определенном месте и в оговоренные сроки.
Таким образом, спонсируемый распространяет информацию о спонсоре, а спонсорский вклад, вносимый по спонсорскому договору, является платой за эту услугу. В свою очередь, распространение информации о спонсоре есть не что иное, как реклама.

## Инфологическая модель БД
![](./Datalogical%20Model-INF.svg)

## Даталогическая модель БД
![](./Datalogical%20Model-DAT.svg)

https://app.diagrams.net/#G1tPSEUiRs9WZIR3xWAgEGuKhvABxdO-Ym

## Сценарии использования базы данных
Основное предназначение базы данных &mdash; обеспечить пользователям доступ к информации о турнирах

Из предназначения базы данных следуют основные пути её использования:
* Добавление нового:
    * пользователя (игрок/организатор/артист/спонсор)
    * спонсорского контракта
    * набора правил
    * характеристики персонажа
    * правила
    * персонажа
    * турнира
    * выступления
    * игровой сессии
    * игрового события
    * таблицы результатов
* Модификация характеристик персонажа

### Описание основных прецедентов
Прецедент             | Добавление нового пользователя
:-----                | :----
ID                    | 1
Краткое описание      | В таблицу `human` добавляется новый человек
Главные акторы        | Администратор базы данных
Предусловия           | О человеке должна быть обязательно заполнена следующая информация: имя и доп. информация.
Основной поток        | <ol><li>Администратор базы данных вносит информацию о человеке: `name`, `info`, `phone`, `email`, `telegram`, `vk` </li><li>Создается человек с `name`, `info`, `phone`, `email`, `telegram`, `vk` </li></ol>

Прецедент             | Добавление нового игрока
:-----                | :----
ID                    | 2
Краткое описание      | В таблицу `player` добавляется новый игрок
Главные акторы        | Администратор базы данных
Предусловия           | Запись о соответствующем человеке должна существовать в таблице `human`
Основной поток        | Администратор базы данных назначает человеку роль "игрок", создавая соответствующую запись в таблице `player`

Прецедент             | Добавление нового артиста
:-----                | :----
ID                    | 3
Краткое описание      | В таблицу `artist` добавляется новый игрок
Главные акторы        | Администратор базы данных
Предусловия           | Запись о соответствующем человеке должна существовать в таблице `human`
Основной поток        | Администратор базы данных назначает человеку роль "артист", создавая соответствующую запись в таблице `artist`

Прецедент             | Добавление нового организатора
:-----                | :----
ID                    | 4
Краткое описание      | В таблицу `organizer` добавляется новый игрок
Главные акторы        | Администратор базы данных
Предусловия           | Запись о соответствующем человеке должна существовать в таблице `human`
Основной поток        | Администратор базы данных назначает человеку роль "организатор", создавая соответствующую запись в таблице `organizer`

Прецедент             | Добавление нового спонсора
:-----                | :----
ID                    | 5
Краткое описание      | В таблицу `sponsor` добавляется новый спонсор
Главные акторы        | Администратор базы данных
Предусловия           | Запись о соответствующем человеке должна существовать в таблице `human`
Основной поток        | Администратор базы данных назначает человеку роль "спонсор", создавая соответствующую запись в таблице `Sponsor`

Прецедент             | Добавление нового спонсорского контракта
:-----                | :----
ID                    | 6
Краткое описание      | В таблицу `sponsor_contract` добавляется новый контракт
Главные акторы        | Администратор базы данных
Предусловия           | <ol><li>Запись об организаторе должна существовать в таблице `organizer`.</li><li>Запись о спонсоре должна существовать в таблице `Sponsor`.</li><li>О контракте должна быть обязательно заполнена следующая информация: спонсор, организатор, информация о контракте</li></ol>
Основной поток        | <ol><li>Администратор базы данных вносит информацию о контракте: `sponsor`, `organizer`, `info` </li><li>Создается контракт с `sponsor`, `organizer`, `info` </li></ol>

Прецедент | Добавление нового набора правил
:--- | :---
ID  | 7
Краткое описание | В таблицу `rule_set` добавляется новый набор правил
Главные акторы | Администратор базы данных
Предусловия | <ol><li>У набора правил должно быть название</li></ol>
Основной поток | <ol><li>Администратор базы данных вносит информацию о наборе правил: `name`</li><li>Создается набор правил с заданным именем</li></ol>

Прецедент | Добавление типа характеристик в набор правил
:--- | :---
ID | 8
Краткое описание | К набору правил добавляется тип характеристики персонажа
Главные акторы | Администратор базы данных
Предусловия | <ol><li>Задан набор правил</li><li>Есть информация о типе характеристики</li></ol>
Основной поток | <ol><li>Администратор вносит информацию: набор правил, имя характеристики, описание, значение по умолчанию (опционально)</li><li>Создается запись о типе характеристики</li><li>У всех существующих персонажей в данном наборе правил создается запись об этой характеристике со значением по умолчанию</li></ol>

Прецедент | Добавление правила в набор правил
:--- | :---
ID | 9
Краткое описание | К набору правил добавляется новое правило
Главные акторы | Администратор базы данных
Предусловия | <ol><li>Задан набор правил</li><li>Есть информация о правиле</li></ol>
Основной поток | <ol><li>Администратор вносит информацию: набор правил, условие, тип характеристики, модифицируемый правилом, тип изменения, величина изменения</li><li>Создается запись о правиле</li></ol>

Прецедент | Добавление персонажа
:--- | :---
ID | 10
Краткое описание | Создается новый персонаж, принадлежащий игроку и относящийся к набору правил
Главные акторы | Администратор базы данных
Предусловия | <ol><li>Задан набор правил</li><li>Задан игрок</li><li>Есть информация о персонаже</li></ol>
Основной поток | <ol><li>Администратор вносит информацию: набор правил, игрок, имя персонажа</li><li>Создается запись о персонаже</li><li>Создаются записи о характеристиках из набора правил со значениями по умолчанию</li></ol>

Прецедент | Добавление турнира
:--- | :---
ID | 11
Краткое описание | Создается турнир
Главные акторы | Администратор базы данных
Предусловия | <ol><li>Существует организатор</li><li>Задан набор правил</li><li>Есть информация о турнире</li></ol>
Основной поток | <ol><li>Администратор вносит информацию: набор правил, место и время проведения (начало и конец), организатор</li><li>Создается запись о турнире</li></ol>

Прецедент | Добавление выступления артиста
:--- | :---
ID | 12
Краткое описание | Запись о выступлении артиста
Главные акторы | Администратор базы данных
Предусловия | Артист выступил на турнире
Основной поток | <ol><li>Администратор вносит информацию: артист, турнир</li><li>Создается запись о выступлении артиста на турнире</li></ol>

Прецедент | Добавление игры на турнире
:--- | :---
ID | 13
Краткое описание | Запись о начале игры
Главные акторы | Администратор базы данных
Предусловия | На турнире производится игра
Основной поток | <ol><li>Администратор вносит информацию: турнир, где проводится игра</li><li>Создается запись о новой игре на этом турнире</li></ol>

Прецедент | Добавление игрового события в игре
:--- | :---
ID | 14
Краткое описание | Запись об игровом событии
Главные акторы | Администратор базы данных
Предусловия | В игре произошло событие
Основной поток | <ol><li>Администратор вносит информацию: игра, агент (персонаж), объект (персонаж), описание события, время события, примененное правило</li><li>Создается запись об игровом событии</li><li>Обновляются характеристики персонажа в соответствии с правилом</li></ol>

Прецедент | Добавление результата выступления игрока на турнире
:--- | :---
ID | 15
Краткое описание | Запись о счете игрока
Главные акторы | Администратор базы данных
Предусловия | Прошел турнир. Запись о соответствующем турнире должна существовать в таблице `tournament`
Основной поток | <ol><li>Администратор вносит информацию: турнир, игрок, счет, место</li><li>Создается запись о выступлении игрока на турнире</li></ol>

Прецедент | Обновление характеристик персонажа
:--- | :---
ID | 16
Краткое описание | Ручное обновление характеристик персонажа
Главные акторы | Администратор базы данных
Предусловия | Запись о соответствующем персонаже должна существовать в таблице `character`. Расхождение между записью о характеристиках персонажа и реальным значением
Основной поток | <ol><li>Администратор вносит информацию: персонаж, тип характеристики, правильное значение</li><li>Обновляется запись о характеристике персонажа</li></ol>

Прецедент | Получение списка людей по имени
:--- | :---
ID | 17
Краткое описание | Список людей из таблицы `human` с указанным `name`
Главные акторы | Администратор базы данных, Пользователь
Предусловия | Запись о соответствующем человеке должна существовать в таблице `human`
Основной поток | <ol><li>Актор вносит информацию &mdash; имя человека</li><li>Система отображает список людей с указанным именем</li></ol>

Прецедент | Получение результатов турнира по номеру
:--- | :---
ID | 18
Краткое описание | Список результатов для турнира с указанным `id`
Главные акторы | Администратор базы данных, Пользователь
Предусловия | Запись о соответствующем турнире должна существовать в таблице `tournament`
Основной поток | <ol><li>Актор кликает по номеру (id) турнира</li><li>Система отображает список результатов для турнира с указанным номером</li></ol>

Прецедент | Получение всех результатов определенного участника
:--- | :---
ID | 19
Краткое описание | Список результатов для человека с указанным `id`
Главные акторы | Администратор базы данных, Пользователь
Предусловия | Запись о соответствующем человеке должна существовать в таблице `human`
Основной поток | <ol><li>Актор кликает по id человека из списка участников турнира</li><li>Система отображает список результатов для выбранного человека</li></ol>

Прецедент | Получение списка турниров по месту их проведения
:--- | :---
ID | 20
Краткое описание | Список турниров с указанным `place`
Главные акторы | Администратор базы данных, Пользователь
Предусловия | Запись о соответствующем турнире должна существовать в таблице `tournament`
Основной поток | <ol><li>Актор вносит информацию &mdash; место проведения турнира</li><li>Система отображает список турниров, проведенных в указанном месте</li></ol>

### Функции:
* `modify_character_stat` &mdash; функция обновления характеристик персонажа;
* `humans_by_name` &mdash; функция получения списка людей с указанным `human.name`;
* `tournament_result_by_tournament` &mdash; функция получения таблицы результатов для турнира с указанным `tournament.id`;
* `tournament_result_by_human` &mdash; функция получения таблицы результатов для человека с указанным `human.id`;
* `tournaments_by_place` &mdash; функция получения списка турниров по месту их проведения (`tournament.place`);

### Триггеры:
* `trigger_character_stats` &mdash; триггер, срабатывающий при добавлении персонажа в `character` и устанавливающий его характеристики по умолчанию;
* `trigger_new_stat` &mdash; триггер, срабатывающий при добавлении характеристики в `character_stat_type` и устанавливающий ей значение по умолчанию у всех персонажей из того же набора правил;
* `trigger_game_event` &mdash; триггер, срабатывающий при добавлении события в `game_event` и обновляющий характеристику персонажа в соответствии с произошедшим событием;

### Индексы:
* `human(name)` &mdash; b-tree индекс на атрибут `name` в таблице `human`, позволяющий ускорить выполнение запросов, получающих `id` человека по его `name`;

Остальные индексы нужны по первичным ключам, и автоматически создаются PostgreSQL.
